<mat-form-field
    [appearance]="appearance()"
    [floatLabel]="floatLabel()"
    style="width: 100%"
>
    @if(label()){<mat-label>{{ label() }}</mat-label
    >}
    <input
        matInput
        #input
        [type]="showPassword() === false ? 'password' : 'text'"
        [autocomplete]="autocomplete()"
        [value]="value()"
        (input)="onInput($event, $event.target?.['value'])"
        (blur)="markAsTouched()"
        [readonly]="readonly()"
        [placeholder]="placeholder()"

        [required]="required()"
    />
    <button
        tabindex="-1"
        type="button"
        matSuffix
        mat-icon-button
        (click)="$event.stopPropagation(); showPassword.set(!showPassword())"
    >
        <mat-icon>{{
            showPassword ? 'visibility_off' : 'visibility'
        }}</mat-icon>
    </button>

    @if(canGenerateRandomPassword() === true){
    <button
        tabindex="-1"
        type="button"
        matSuffix
        mat-icon-button
        (click)="$event.stopPropagation(); generateRandomPassword()"
    >
        <mat-icon>key</mat-icon>
    </button>
    } @if(showConfirmPasswordInput() !== true){
    <ng-container *ngTemplateOutlet="errorsTemplate"></ng-container>
    }
</mat-form-field>

@if (confirmControl) {
<mat-form-field
    [appearance]="appearance()"
    [floatLabel]="floatLabel()"
    style="width: 100%"
>
    <input
        matInput
        #input
        [type]="showPassword() !== false ? 'text' : 'password'"
        (input)="confirmControl.markAsDirty()"
        [autocomplete]="autocomplete()"
        (blur)="changeTouchedStatus(confirmControl)"
        [readonly]="readonly()"
        placeholder="Confirm Password"
        [formControl]="confirmControl"
        [required]="required()"
    />
    @if(showConfirmPasswordInput() === true){
    <ng-container *ngTemplateOutlet="errorsTemplate"></ng-container>
    }
</mat-form-field>
}

<ng-template #errorsTemplate>
    @if (hint()) {
    <mat-hint>{{ hint() }}</mat-hint>
    } @for (error of control().errors | keyvalue; track error.key) {
    <mat-error style="display: flex">
        {{ error.key }}
        <span style="flex: 1"></span>
        @if (error.value['required']) {
        <span style="white-space: nowrap"
            >{{ error.value['current'] }} / {{ error.value['required'] }}</span
        >
        }
    </mat-error>
    }
</ng-template>
