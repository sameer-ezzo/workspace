<form #dynForm="ngForm" [attr.id]="name()" class="dynamic-form" (ngSubmit)="onSubmit($event)">
    @for (k of _keys(fields()); track $index) { @let _field =fields()[k]; @let fieldInfo = getFieldIfo(_field);
    <ng-container
        *ngTemplateOutlet="
            fieldTemplate;
            context: {
                field: _field,
                template: fieldInfo.template,
                control: fieldInfo.control,
                form: fieldInfo.form
            }
        "
    ></ng-container>
    }
    <input type="submit" style="display: none" />
</form>

<ng-template #fieldTemplate let-field="field" let-template="template" let-formGroup="form" let-control="control">
    @let fieldName = field.name; @let ui = field.ui; @let id = ui?.id || field.name; @let input = field.input; @if (field.type === "fieldset") {
    <fieldset [attr.id]="id" class="{{ input }}-input {{ id }}-container ff-container" [formGroup]="formGroup" [class.hidden]="ui?.hidden === true">
        @if (input === "paragraph" || field.text) {
        <paragraph [text]="field.text" [renderer]="ui?.inputs?.['renderer'] || 'markdown'"></paragraph>
        } @if (ui?.inputs?.label) {
        <legend>{{ ui.inputs.label }}</legend>
        } @for (k of _keys(field.items); track $index) { @let _field =field.items[k]; @let fieldInfo = getFieldIfo(_field);

        <ng-container *ngTemplateOutlet="fieldTemplate; context: { field: _field, template: fieldInfo.template, control: fieldInfo.control, form: fieldInfo.form }"> </ng-container>
        }
    </fieldset>
    } @else { @switch (input) { @case ("page-breaker") {
    <p style="display: none"></p>
    } @case ("paragraph") {
    <paragraph
        [attr.id]="id"
        class="{{ input }}-input {{ id }}-container ff-container"
        [class.hidden]="ui?.hidden === true"
        [text]="field.text"
        [renderer]="ui?.inputs?.['renderer'] || 'markdown'"
    ></paragraph>
    } @default {
    <dynamic-form-field [field]="field" [template]="template" [formControl]="control" [control]="control"></dynamic-form-field>
    } } }
</ng-template>

<ng-template #icon>
    <mat-icon mat-list-icon color="error">error</mat-icon>
</ng-template>
