<form
    #dynForm="ngForm"
    [attr.id]="name()"
    class="dynamic-form"
    (ngSubmit)="onSubmit($event)"
    [formGroup]="formRenderer.form"
>
    @for(fieldInfo of vm().fields; track $index) {

    <ng-container
        *ngTemplateOutlet="
            fieldTemplate;
            context: {
                field: fieldInfo.field,
                template: fieldInfo.template,
                form: vm().formGroup
            }
        "
    ></ng-container>
    } @if(recaptcha()){
    <form-recaptcha-field
        [key]="recaptcha()"
        [(value)]="value['g-recaptcha-response']"
    ></form-recaptcha-field>
    }
    <input type="submit" style="display: none" />
</form>

<ng-template
    #fieldTemplate
    let-field="field"
    let-template="template"
    let-form="form"
>
    @if (field.type === 'fieldset') {
    <fieldset
        id="{{ field.ui?.id || field.name }}-container"
        class="{{ field.input }}-input ff-container"
        [formGroup]="form"
        [class.hidden]="field.ui?.hidden === true"
    >
        @if (field.input === 'paragraph' || field.text) {
        <paragraph
            [text]="field.text"
            [renderer]="field.ui?.inputs?.['renderer'] || 'markdown'"
        ></paragraph>
        } @if (field?.ui?.inputs?.label) {
        <legend>{{ field.ui.inputs.label }}</legend>
        } @for (item of _values(field.items); track item.path) {
        <ng-container
            *ngTemplateOutlet="
                fieldTemplate;
                context: { field: item, form: form.get(field.name) }
            "
        >
        </ng-container>
        }
    </fieldset>
    } @else { @switch (field.input) { @case ('page-breaker') {
    <p style="display: none"></p>
    } @case ('paragraph') {
    <paragraph
        id="{{ field.ui?.id || field.name }}-container"
        class="{{ field.input }}-input ff-container"
        [class.hidden]="field.ui?.hidden === true"
        [text]="field.text"
        [renderer]="field.ui?.inputs?.['renderer'] || 'markdown'"
    ></paragraph>
    } @default {
    <dynamic-form-field
        [field]="field"
        [template]="template"
        [form]="form"
    ></dynamic-form-field>
    } }
    <!-- <mat-list *ngIf="form[field.name]?.touched">
    <mat-list-item *ngFor="let error of helper.controls[field.name].errors | keyvalue">
      <button type="button" style="margin:5px;box-shadow: 0px 2px 5px -1px rgba(0, 0, 0, 0.2), 0px 1px 10px 0px rgba(0, 0, 0, 0.14);" mat-mini-fab color="accent" *ngIf="error.value?.validationTask && validationTasks[field.name].state != 'error'; else icon" [disabled]="validationTasks[field.name].disabled" matTooltip="{{validationTasks[field.name].error?.msg}}" (click)="runValidationTask(field)">
        <mat-icon>{{helper.validationTasks[field.name].state}}</mat-icon>
      </button>
      <div>{{error.key}}</div>
    </mat-list-item>
  </mat-list> -->
    }
</ng-template>

<ng-template #icon>
    <mat-icon mat-list-icon color="error">error</mat-icon>
</ng-template>
